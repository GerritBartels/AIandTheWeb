<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>List of channels</title>
        
        <!-- Custom Stylesheet -->
        <link rel="stylesheet"
            href="{{ url_for('static', filename='css/styles.css')}}">
    </head>
    <body>

        <div class="banner">
            <a href="{{url_for('home_page')}}">
                <img src="{{ url_for('static', filename='img/Logo_chat.png')}}" alt="Logo" class="logo">
            </a>
            <h1>WhatsWebApp</h1>
            <select id="current-user" class="user-dropdown">
                {% for user in users %}
                    <option value="{{ user.username }}">{{ user.username }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="left-panel">
            <h2><div class="left-panel-text">Local Channels:</div></h2>
            {% for channel in local_channels %}
                <div class="channel left-panel-text">
                    <h3>
                        <a href="#" class="channel-link" data-channel="{{ channel.endpoint | urlencode }}" data-id="{{ channel.id }}">{{ channel.name }}</a>
                    </h3>
                    Sender: Last Message.
                </div>
            {% endfor %}

            <br><br><br><br>
            <h2><div class="left-panel-text">Remote Channels:</div></h2>
            {% for channel in remote_channels %}
                <div class="channel left-panel-text">
                    <h3>
                        <a href="#" class="channel-link" data-channel="{{ channel.endpoint | urlencode }}" data-id="None">{{ channel.name }}</a>
                    </h3>
                    Sender: Last Message.
                </div>
            {% endfor %}
        </div>
        
        <div class="right-panel" id="channel-content">
            <h2><div class="channel-header">Welcome to WhatsWebApp</div></h2>
            <p class="channel-header">Please select a channel to view the messages.</p>
        </div>
        <div class="right-panel-bottom-placeholder"></div>
        
        <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
        <script>
            $(document).ready(function() {
                $('.channel-link').click(function(e) {
                    e.preventDefault(); // Prevent the default action
                    var channel = $(this).data('channel'); // Get the channel from the data-channel attribute
                    var channel_id = $(this).data('id') || null; // Get the channel id from the data-id attribute
                    var sender = $('#current-user').val();
                    $.ajax({
                        url: '/show',
                        type: 'GET',
                        data: { channel: channel, channel_id: channel_id, sender: sender},
                        success: function(response) {
                            // Insert the response into the #channel-content element
                            $('#channel-content').html(response);
                            // Scroll to the bottom of the container
                            var container = document.querySelector('#channel-content');
                            container.scrollTop = container.scrollHeight;
                        },
                        error: function(error) {
                            console.log(error);
                        }
                    });
                });
            });
        </script>
    </body>
</html>